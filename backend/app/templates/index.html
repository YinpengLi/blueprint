<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>ChatGPT KB Agent</title>
  <style>
    body{font-family:system-ui,Arial;margin:24px;max-width:980px}
    code{background:#f3f3f3;padding:2px 4px;border-radius:4px}
    input,select{padding:8px;margin:6px 0;width:100%}
    .row{display:flex;gap:10px}
    .row>div{flex:1}
    button{padding:10px 14px}
    .box{border:1px solid #ddd;padding:14px;border-radius:10px;margin:14px 0}
    pre{background:#0b1020;color:#cfe3ff;padding:12px;border-radius:10px;overflow:auto}
  </style>
</head>
<body>
  <h2>ChatGPT Knowledge Base Agent (OneDrive)</h2>

  <div class="box">
    <h3>OneDrive</h3>
    <p>Status: <span id="odstatus">checking...</span></p>
    <p><a href="/api/auth/onedrive/start" target="_blank">Connect OneDrive</a></p>
    <button onclick="check()">Refresh status</button>
  </div>

  <div class="box">
    <h3>Upload files (PDF/DOCX/XLSX indexed)</h3>
    <form method="post" action="/api/ingest/upload" enctype="multipart/form-data">
      <div class="row">
        <div><label>Project</label><input name="project" value="Unsorted"/></div>
        <div><label>Area</label><input name="area" value="General"/></div>
        <div><label>Topic</label><input name="topic" value="General"/></div>
      </div>
      <label>(Optional) Link to Chat ID</label>
      <input name="chat_id" placeholder="uuid"/>
      <label>File</label>
      <input type="file" name="file" required/>
      <p>If you set <code>INGEST_API_KEY</code>, this form will fail unless you remove the key or use the extension which sends the header.</p>
      <button type="submit">Upload</button>
    </form>
  </div>

  <div class="box">
    <h3>Search</h3>
    <input id="q" placeholder="Search..."/>
    <select id="mode">
      <option value="hybrid">Hybrid</option>
      <option value="keyword">Keyword</option>
      <option value="semantic">Semantic</option>
    </select>
    <button onclick="runSearch()">Search</button>
    <pre id="results"></pre>
  </div>

<script>
async function check(){
  const r = await fetch('/api/auth/onedrive/status');
  const j = await r.json();
  document.getElementById('odstatus').textContent = j.connected_onedrive ? 'Connected' : 'Not connected';
}
check();

async function runSearch(){
  const q = document.getElementById('q').value;
  const mode = document.getElementById('mode').value;
  const r = await fetch('/api/search?q=' + encodeURIComponent(q) + '&mode=' + mode);
  const j = await r.json();
  document.getElementById('results').textContent = JSON.stringify(j, null, 2);
}
</script>
</body>
</html>
